# üö® URGENT: Fix "Cannot connect to database" Error

## üî¥ You're seeing this error:
```
api/auth/signup:1 Failed to load resource: the server responded with a status of 500
Cannot connect to database. Please check your DATABASE_URL configuration.
```

## ‚úÖ SOLUTION (Do this NOW):

### Step 1: Get Your Supabase Connection String

1. Go to [supabase.com](https://supabase.com) and login
2. Select your project (the one with URL: `eulpiddbrbqchwrkulug.supabase.co`)
3. Go to **Settings** (gear icon) ‚Üí **Database**
4. Scroll down to **Connection string** section
5. Find **URI** tab (not "Session mode" or "Transaction mode")
6. Copy the connection string - it looks like:
   ```
   postgresql://postgres:[YOUR-PASSWORD]@db.eulpiddbrbqchwrkulug.supabase.co:5432/postgres
   ```
7. **Replace `[YOUR-PASSWORD]`** with your actual database password
   - If you don't know the password, go to **Settings** ‚Üí **Database** ‚Üí **Database password** to reset it

### Step 2: Add DATABASE_URL in Netlify Dashboard

**‚ö†Ô∏è CRITICAL: You MUST do this in the Netlify Dashboard, NOT in netlify.toml**

1. Go to [app.netlify.com](https://app.netlify.com)
2. Login to your account
3. Click on your site (capsoai.com or your site name)
4. Click **Site settings** (in the top menu)
5. Click **Build & deploy** (in the left sidebar)
6. Click **Environment** (in the left sidebar)
7. Click **Environment variables** (or scroll down to the variables section)
8. Click **Add variable** button
9. Fill in:
   - **Key**: `DATABASE_URL`
   - **Value**: Paste your connection string from Step 1 (with password replaced)
   - **Scopes**: Leave as "All scopes" (default)
   - **Deploy contexts**: Leave as "All deploy contexts" (default)
10. Click **Save** or **Add variable**

### Step 3: Verify the Variable Was Added

After saving, you should see `DATABASE_URL` in the list of environment variables.

**Check that:**
- ‚úÖ The variable name is exactly `DATABASE_URL` (case-sensitive)
- ‚úÖ The value starts with `postgresql://` (not `postgresql://build:build@build:5432/build`)
- ‚úÖ The value contains your real Supabase hostname (`db.eulpiddbrbqchwrkulug.supabase.co`)

### Step 4: Create Database Tables

After adding `DATABASE_URL`, you need to create the database tables:

**Option A: Using Prisma (Recommended)**

1. Open your terminal
2. Make sure you have `DATABASE_URL` in your `.env.local` file:
   ```bash
   DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@db.eulpiddbrbqchwrkulug.supabase.co:5432/postgres
   ```
3. Run:
   ```bash
   npx prisma db push
   ```
4. This will create all the tables in your database

**Option B: Using Supabase SQL Editor**

1. Go to Supabase ‚Üí Your project ‚Üí **SQL Editor**
2. Click **New query**
3. Run this SQL (from your Prisma schema):
   ```sql
   -- This will be generated by Prisma, but you can also use:
   npx prisma migrate dev
   ```

### Step 5: REDEPLOY on Netlify

**‚ö†Ô∏è IMPORTANT: You MUST redeploy after adding DATABASE_URL**

1. In Netlify, go to **Deploys** tab
2. Click **Trigger deploy** ‚Üí **Deploy site**
3. Wait for the build to complete (2-3 minutes)
4. The site will automatically use the new `DATABASE_URL`

### Step 6: Test

1. Go to your website
2. Try to create an account
3. The error should be gone!

## üîç Troubleshooting

### If you still see the error:

1. **Check Netlify Function Logs:**
   - Go to Netlify ‚Üí Your site ‚Üí **Functions** ‚Üí **Logs**
   - Look for error messages about DATABASE_URL
   - The logs will show if it's using the placeholder or the real URL

2. **Verify DATABASE_URL format:**
   - Should be: `postgresql://postgres:PASSWORD@db.xxxxx.supabase.co:5432/postgres`
   - Password should NOT have `[` or `]` brackets
   - If password has special characters, they need to be URL-encoded:
     - `@` becomes `%40`
     - `#` becomes `%23`
     - `%` becomes `%25`
     - etc.

3. **Check if database is accessible:**
   - Try connecting with a PostgreSQL client (like pgAdmin or DBeaver)
   - If you can't connect, check Supabase settings ‚Üí Database ‚Üí Connection pooling

4. **Make sure you redeployed:**
   - Adding the variable doesn't automatically redeploy
   - You MUST manually trigger a deploy (Step 5)

## üìù Quick Checklist

- [ ] Got connection string from Supabase
- [ ] Replaced `[YOUR-PASSWORD]` with real password
- [ ] Added `DATABASE_URL` in Netlify dashboard (not netlify.toml)
- [ ] Verified variable is in the list
- [ ] Created database tables (`npx prisma db push`)
- [ ] Triggered redeploy on Netlify
- [ ] Tested signup - error should be gone

## üÜò Still Having Issues?

If you've done all the steps above and still see the error:

1. Check Netlify function logs (Site settings ‚Üí Functions ‚Üí Logs)
2. Share the error message from the logs
3. Verify your Supabase database is running and accessible









